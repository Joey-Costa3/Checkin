{% extends "attendance/base.html" %}

{% block titleModifier %}
	- History
{% endblock %}


{% block headerTitle %}
  History
{% endblock %}


{% block headerParagraph %}
   View your SoC Checkin attendance history below.
{% endblock %}


{% block bodyContent %}
<script>
$(document).ready( function () {
    $("#students-attendance-history-table").DataTable({
    "order": [[0, "desc"]]
    });
} );
</script>

<div id="csvarea">


<textarea id="txt"  name="{{ username }}" class="txtarea hidden" style="display:none;" aria-label="CSV File Text">
[
{% for record in records %}
{# // After appending all records from the same course insert a blank section. Then add data from next course #}
{% ifchanged record.courseid %}
{% if forloop.first %}
{% else %}
{"Course":"","Date":"","Status":""},
{% endif %}
{"Course":"{{ record.courseid|safe }}","Date":"{{ record.date|safe }}","Status":"{% if record.status == 'P' %}Present{% elif record.status == 'U' %}Unexcused{% elif record.status == 'E' %}Excused{% elif record.status == 'T' %}Tardy{% else %}{% endif %}"}
{% else %}
{"Course":"{{ record.courseid|safe }}","Date":"{{ record.date|safe }}","Status":"{% if record.status == 'P' %}Present{% elif record.status == 'U' %}Unexcused{% elif record.status == 'E' %}Excused{% elif record.status == 'T' %}Tardy{% else %}{% endif %}"}
{% endifchanged %}

{% if forloop.last %}

{% else %}
,
{% endif %}
{% endfor %}
]
</textarea>
<br><button id="download">Download CSV</button>
</div>


<table class="table table-striped" id="students-attendance-history-table">
<thead>
<tr>
<th>Date</th>
<th data-orderable="false">Month Day</th>
<th>Course</th>
<th>Record</th>
</tr>
</thead>
<tbody>
{% for r in records  %}
	<tr>
	<td>{{ r.date|date:"Y-m-d" }}</td>
  <td>{{ r.date|date:"D M d" }} </td>
	<td>{{ r.courseid }} </td>
	<td>{{ r.status }} </td>
	</tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
